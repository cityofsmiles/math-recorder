<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Record Sheet in Math</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Track math activities, practices, quizzes, and more">
  <meta name="theme-color" content="#4285f4">
  <link rel="manifest" href="#" id="manifest-placeholder">
  <link rel="icon" type="image/png" href="#" id="icon-placeholder">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Math Records">

  <style>
    body { font-family: Arial, sans-serif; margin: 10px; font-size: 16px; }
    h2 { text-align: center; }

    /* LOGIN OVERLAY */
    #loginOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #loginBox {
      background: white;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.4);
    }
    #loginBox input { width: 100%; padding: 12px; border-radius: 5px; border: 2px solid #ccc; }
    #loginBox button {
      width: 100%; padding: 12px; background: #4285f4; color: white;
      border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;
    }
    #loginError { color: red; display: none; text-align: center; margin-top: 10px; }

    .hidden { display: none; }

    table {
      width: 100%; border-collapse: collapse; min-width: 700px;
    }
    th, td { border: 1px solid #ccc; padding: 0; }
    input.cell { width: 100%; border: none; padding: 4px; box-sizing: border-box; }
    input.cell:focus { outline: 2px solid dodgerblue; background: #eef6ff; }
    input.cell[readonly] { background: #f5f5f5; }

    #status {
      position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
      background: black; color: white; padding: 10px 20px;
      border-radius: 5px; opacity: 0; transition: opacity .2s;
    }
  </style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginOverlay">
  <div id="loginBox">
    <h3>Leader Login</h3>
    <p style="text-align: center; color: #777;">Enter your password</p>
    <input type="password" id="passwordInput" autocomplete="off">
    <button id="loginBtn">Login</button>
    <div id="loginError">Incorrect password</div>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="mainContent" class="hidden">

<h2>Record Sheet in Math</h2>

<div>
  <label>Leader</label><input id="leaderName">
  <label>Section</label><input id="section">
  <label>Group</label><input id="groupNumber">
</div>

<!-- TABLES (same as your version, unchanged markup) -->
<div class="table-section">
  <div class="table-wrapper">
    <table id="table1">
      <thead>
        <tr>
          <th>Last</th><th>First</th>
          <!-- 24 headers -->
          ${Array(24).fill().map(()=>`<th><input class="cell"></th>`).join("")}
          <th>Activity</th>
        </tr>
      </thead>
      <tbody id="table1-tbody"></tbody>
    </table>
  </div>
  <button id="saveBtnTable1">Save Activity</button>
  <button id="clearBtnTable1">Clear Activity</button>
</div>

<!-- (TABLE2, TABLE3, TABLE4, TABLE5 remain exactly the same as your version) -->

<button id="copyBtn">Copy CSV</button>
<button id="syncBtn">Sync to Google Sheets</button>
<div id="status"></div>
</div>

<script>
/* GOOGLE SCRIPT URL */
const GOOGLE_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbx3MgS3mfEs4naEfVXUfjd7jsRljF6Oy6eIFp5V66e_sKVULy6_benmNhDywsB2SFFR/exec";

/* PASSWORDS */
const PASSWORDS = {
  "1-1":"password11","1-2":"password12","1-3":"password13","1-4":"password14","1-5":"password15",
  "2-1":"password21","2-2":"password22","2-3":"password23","2-4":"password24","2-5":"password25",
  "3-1":"password31","3-2":"password32","3-3":"password33","3-4":"password34","3-5":"password35",
  "4-1":"password41","4-2":"password42","4-3":"password43","4-4":"password44","4-5":"password45",
  "5-1":"password51","5-2":"password52","5-3":"password53","5-4":"password54","5-5":"password55",
  "6-1":"password61","6-2":"password62","6-3":"password63","6-4":"password64","6-5":"password65"
};

/* LOGIN PARAMS */
const urlParams = new URLSearchParams(location.search);
const classParam = urlParams.get("class");
const leaderParam = urlParams.get("leader");
const leaderKey = `${classParam}-${leaderParam}`;
const correctPassword = PASSWORDS[leaderKey];
const sessionKey = `auth_${leaderKey}`;

const loginOverlay = document.getElementById("loginOverlay");
const mainContent = document.getElementById("mainContent");
const loginError = document.getElementById("loginError");
const passwordInput = document.getElementById("passwordInput");

/* AUTO LOGIN (SESSION STORAGE) */
if (sessionStorage.getItem(sessionKey) === "authenticated") {
  loginOverlay.classList.add("hidden");
  mainContent.classList.remove("hidden");
}

/* LOGIN CHECK */
function checkPassword() {
  const pass = passwordInput.value.trim();

  if (!correctPassword) {
    loginError.textContent = "Invalid link (class/leader missing)";
    loginError.style.display = "block";
    return;
  }

  if (pass === correctPassword) {
    sessionStorage.setItem(sessionKey, "authenticated");
    loginOverlay.classList.add("hidden");
    mainContent.classList.remove("hidden");
    loginError.style.display = "none";
    initialLoad();
  } else {
    loginError.style.display = "block";
    passwordInput.value = "";
  }
}

document.getElementById("loginBtn").onclick = checkPassword;
passwordInput.onkeypress = e => { if (e.key === "Enter") checkPassword(); };
passwordInput.focus();

/* UNIQUE STORAGE */
const STORAGE_KEY =
  classParam && leaderParam
    ? `math_${classParam}_${leaderParam}`
    : "math_record_default";

const ROW_COUNT = 11;

/* TABLE ELEMENTS */
const table1Tbody = document.getElementById("table1-tbody");
const table2Tbody = document.getElementById("table2-tbody");
const table3Tbody = document.getElementById("table3-tbody");
const table4Tbody = document.getElementById("table4-tbody");
const table5Tbody = document.getElementById("table5-tbody");

function renderRow(tbody, cols, data = [], readOnly = []) {
  const tr = document.createElement("tr");
  for (let i = 0; i < cols; i++) {
    const td = document.createElement("td");
    const input = document.createElement("input");
    input.className = "cell";
    input.value = data[i] || "";
    if (readOnly.includes(i)) input.readOnly = true;
    td.appendChild(input);
    tr.appendChild(td);
  }
  tbody.appendChild(tr);
}

/* LOAD */
function initialLoad() {
  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

  // Fill info boxes
  leaderName.value = saved.leader || "";
  section.value = saved.section || "";
  groupNumber.value = saved.group || "";

  // Generate tables
  for (let i = 0; i < ROW_COUNT; i++) {
    renderRow(table1Tbody, 27, saved.table1?.[i] || [], [26]);
    renderRow(table2Tbody, 27, saved.table2?.[i] || [], [26]);
    renderRow(table3Tbody, 16, saved.table3?.[i] || [], [12]);
    renderRow(table4Tbody, 38, saved.table4?.[i] || [], [37]);
    renderRow(table5Tbody, 9, saved.table5?.[i] || [], [0,1,2,3,4,5,6,7,8]);
  }

  setupFormulas();
}

/* FORMULA LOGIC */
function setupFormulas() {
  const t1Rows = table1Tbody.querySelectorAll("tr");
  const t2Rows = table2Tbody.querySelectorAll("tr");
  const t3Rows = table3Tbody.querySelectorAll("tr");
  const t4Rows = table4Tbody.querySelectorAll("tr");
  const t5Rows = table5Tbody.querySelectorAll("tr");

  t1Rows.forEach((row, i) => {
    const t1 = row.querySelectorAll("input.cell");
    const t2 = t2Rows[i].querySelectorAll("input.cell");
    const t3 = t3Rows[i].querySelectorAll("input.cell");
    const t4 = t4Rows[i].querySelectorAll("input.cell");
    const t5 = t5Rows[i].querySelectorAll("input.cell");

    function recalc() {
      /* ACTIVITY SUM */
      let act = 0;
      for (let j = 2; j <= 25; j++) {
        let v = parseFloat(t1[j].value);
        if (!isNaN(v)) act += v;
      }
      t1[26].value = act;
      t5[2].value = act;

      /* PRACTICE SUM */
      let prac = 0;
      for (let j = 2; j <= 25; j++) {
        let v = parseFloat(t2[j].value);
        if (!isNaN(v)) prac += v;
      }
      t2[26].value = prac;
      t5[3].value = prac;

      /* QUIZ, RECITATION, LESSON, SUMMATIVE */
      t5[4].value = t3[12].value;
      t5[5].value = t3[13].value;
      t5[6].value = t3[14].value;
      t5[7].value = t3[15].value;

      /* FLASHCARDS */
      t5[8].value = t4[37].value;
    }

    [...t1, ...t2, ...t3, ...t4].forEach(cell => {
      cell.addEventListener("input", recalc);
    });

    recalc();
  });
}

function showStatus(msg) {
  const status = document.getElementById("status");
  status.textContent = msg;
  status.style.opacity = 1;
  setTimeout(()=>status.style.opacity=0,1500);
}
</script>
</body>
</html>
